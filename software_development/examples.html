

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8. Running Examples &mdash; GMT Software And Controls documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/additional_style.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="GMT Software And Controls documentation" href="../index.html"/>
        <link rel="up" title="Software Development" href="index.html"/>
        <link rel="next" title="9. Contribute" href="contribute.html"/>
        <link rel="prev" title="7. Using the Services" href="services.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> GMT Software And Controls
          

          
            
            <img src="../_static/logowhite.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../release_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SWC_architecture/index.html">Architecture and Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SWC_standards/index.html">Software and Controls Standards</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Software Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">1. Installing the SDK</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrade.html">2. Upgrade</a></li>
<li class="toctree-l2"><a class="reference internal" href="virtual_machine/virtual_machine.html">3. Installing a Virtual Machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="isample_example.html">4. ISample Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="development.html">5. DCS Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">6. Developer Info and Release Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="services.html">7. Using the Services</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">8. Running Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#gmt-components">8.1. GMT Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connecting-components">8.2. Connecting Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-example-components">8.3. Running the example components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-components-and-ports">8.4. Setup Components and Ports</a></li>
<li class="toctree-l3"><a class="reference internal" href="#controllers-example">8.5. Controllers Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#check-monitored-values">8.6. Check Monitored Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="#send-a-command-to-a-controller">8.7. Send a Command to a Controller</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="contribute.html">9. Contribute</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../data_products/index.html">Data Products</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary/swc_sys_glossary.html">Software and Controls Acronyms and Definitions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GMT Software And Controls</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Software Development</a> &raquo;</li>
        
      <li>8. Running Examples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="running-examples">
<span id="id1"></span><h1>8. Running Examples<a class="headerlink" href="#running-examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="gmt-components">
<h2>8.1. GMT Components<a class="headerlink" href="#gmt-components" title="Permalink to this headline">¶</a></h2>
<p>Components are the simple building blocks in the GMT software architecture and they will be used extensively at all levels.
A software component is a unit of composition with contractually specified interfaces and explicit context dependencies only.
Ports are interaction points for components. They can be the data inputs (required interface) or the data outputs (provided interface) of our components.
By using a port, our component is able to de-couple the internals of the component from external entities. The component does not assume anything about external entities.
Any data type can be used in ports: C++ templates, dynamic types, etc.</p>
<p>A GMT Component is able to perform a periodic task and/or is able to interact with other similar components. Components are reactive to their interfaces from the very beginning.
Instead of being called by an external entity they have an internal loop (step) which reacts continuously to inputs and drives the corresponding outputs.
Commands in the sense of “remote calls” from other components do not exist. Only reaction to inputs.</p>
<p>Example: instead of having a moveTo(position) and getPosition() commands we can have:</p>
<blockquote>
<div><ul class="simple">
<li>An input port with the demanded_position</li>
<li>An output with the current_position</li>
<li>The step() reacts to the demanded position and updates the current</li>
</ul>
</div></blockquote>
<p>The most simple possible component that can be created is like this:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="nl">SimpleComponent</span> <span class="p">:</span> <span class="k">public</span> <span class="n">Component</span><span class="o">&lt;</span><span class="n">Component_Conf</span><span class="o">&gt;</span>  <span class="c1">// most simple possible component</span>
<span class="p">{</span>
    <span class="n">SimpleComponent</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">uri</span><span class="p">)</span><span class="o">:</span> <span class="n">Component</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">step</span><span class="p">()</span>  <span class="p">{</span> <span class="n">log_info</span><span class="p">(</span><span class="s">&quot;hello, component world&quot;</span><span class="p">);</span> <span class="p">}</span> <span class="c1">// prints a log message every second (default)</span>
<span class="p">};</span>
</pre></div>
</div>
<p>This component does not have any input or output ports but has a <em>step()</em> function that runs at the default rate of 1 second.
This step only creates a log message at every step but could be used for any other purpose.</p>
<p>Let&#8217;s see an example with input and output ports. The following diagram show a component called Sum with two inputs ports and one output port.
The output port is the sum of the inputs ports:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>      Sum
   +--------+
   <span class="p">|</span>        <span class="p">|</span>
&lt;--<span class="p">|</span>x1    x2<span class="p">|</span>&lt;--        <span class="nv">x1</span> <span class="o">=</span> x2+x3
   <span class="p">|</span>        <span class="p">|</span>
   <span class="p">|</span>      x3<span class="p">|</span>&lt;--
   <span class="p">|</span>        <span class="p">|</span>
   +--------+
</pre></div>
</div>
<p>The class definition for this component is:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Sum</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Component</span><span class="o">&lt;</span><span class="n">Component_Conf</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="k">public</span><span class="o">:</span>
        <span class="kr">inline</span> <span class="n">Sum</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">uri</span><span class="p">)</span><span class="o">:</span> <span class="n">Component</span><span class="p">(</span><span class="n">uri</span><span class="p">),</span> <span class="n">x1</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">x2</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">x3</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">{}</span>

        <span class="kr">inline</span> <span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">new_output_port</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="s">&quot;x1&quot;</span><span class="p">);</span>
            <span class="n">new_input_port</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="s">&quot;x2&quot;</span><span class="p">);</span>
            <span class="n">new_input_port</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span><span class="s">&quot;x3&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kr">inline</span> <span class="kt">void</span> <span class="n">step</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">x3</span><span class="p">;</span>
            <span class="n">log_info</span><span class="p">(</span><span class="s">&quot;sum = &quot;</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">x1</span><span class="p">));</span>
        <span class="p">}</span>

    <span class="k">private</span><span class="o">:</span>
        <span class="kt">int</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>This example only includes integer ports but any type can be used.  The input and output ports default value can be set during a the constructor.
The step() computes the sum and the setup() function is responsible for associating the internal component variables with the corresponding ports.
Once this association is made the ports automatically update (send or receive) the inputs and output values at each step.
The component does not need to do update the ports because, for any component, the framework performs the following generic step:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">Component</span><span class="o">::</span><span class="n">generic_step</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">read_setup</span><span class="p">();</span>
    <span class="n">read_inputs</span><span class="p">();</span>
    <span class="n">step</span><span class="p">();</span>
    <span class="n">write_outputs</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="connecting-components">
<h2>8.2. Connecting Components<a class="headerlink" href="#connecting-components" title="Permalink to this headline">¶</a></h2>
<p>The great thing about components is that they can be easily connected with other components to perform a much more complex function.
A connector is a link that enables communication between components. A connector simply means that runtime component instances can communicate using their ports.</p>
<p>Let&#8217;s create a component type called Inc with just one output port. This component has an initial value that is incremented at every step.
If the internal counter is reset every 1000 steps.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>       Inc
   ----------
   <span class="p">|</span>        <span class="p">|</span>
&lt;--<span class="p">|</span>x1      <span class="p">|</span>      <span class="nv">x1</span> <span class="o">=</span> x1+1
   <span class="p">|</span>        <span class="p">|</span>
   <span class="p">|</span>        <span class="p">|</span>
   <span class="p">|</span>        <span class="p">|</span>
   ----------
</pre></div>
</div>
<p>This is the equivalent c++ class:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Inc</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Component</span><span class="o">&lt;</span><span class="n">Component_Conf</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="k">public</span><span class="o">:</span>
        <span class="kr">inline</span> <span class="n">Inc</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">uri</span><span class="p">)</span><span class="o">:</span> <span class="n">Component</span><span class="p">(</span><span class="n">uri</span><span class="p">),</span> <span class="n">x1</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>

        <span class="kr">inline</span> <span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">new_output_port</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="s">&quot;x1&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kr">inline</span> <span class="kt">void</span> <span class="n">step</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">x1</span><span class="o">++</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x1</span><span class="o">&gt;</span><span class="mi">1000</span><span class="p">)</span> <span class="n">x1</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
            <span class="n">log_info</span><span class="p">(</span><span class="s">&quot;x1 = &quot;</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">x1</span><span class="p">));</span>
        <span class="p">}</span>

    <span class="k">private</span><span class="o">:</span>
        <span class="kt">int</span> <span class="n">x1</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Now we can create several instances of the Inc and Sum component classes and, connecting inputs and outputs, we could create a component network like this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>                    sum1                inc1
   sum2            +---+               +---+
   +---+           <span class="p">|</span>   <span class="p">|</span>&lt;--------------<span class="p">|</span>   <span class="p">|</span>
   <span class="p">|</span>   <span class="p">|</span>&lt;----------<span class="p">|</span> + <span class="p">|</span>               +---+
&lt;--<span class="p">|</span> + <span class="p">|</span>           <span class="p">|</span>   <span class="p">|</span>&lt;-------+
   <span class="p">|</span>   <span class="p">|</span>&lt;-----+    +---+        <span class="p">|</span>       inc2
   +---+      <span class="p">|</span>                 <span class="p">|</span>      +---+
              <span class="p">|</span>                 +------<span class="p">|</span>   <span class="p">|</span>
              <span class="p">|</span>                        +---+
              <span class="p">|</span>
              <span class="p">|</span>                         inc3
              <span class="p">|</span>                        +---+
              +------------------------<span class="p">|</span>   <span class="p">|</span>
                                       +---+
</pre></div>
</div>
<p>Note that this diagram includes five <strong>connectors</strong> between components. These connectors allow to move data between components.
At each step, if the connector is setup, the output of each component instance is sent to the next component in the connector.
It&#8217;s important to know that <strong>each component does not know if connectors exist</strong>: they do not have references to other components.
Each component reads its inputs and proceeds according these values to run the step and write the corresponding outputs.
Components will run even when their ports are not connected to other components.</p>
</div>
<div class="section" id="running-the-example-components">
<h2>8.3. Running the example components<a class="headerlink" href="#running-the-example-components" title="Permalink to this headline">¶</a></h2>
<p>In one terminal open a log client so</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ gds log_service client gmt
log client subscribed at port tcp://127.0.0.1:9995
subscription topic: gmt
</pre></div>
</div>
<p>In a second terminal run the example components</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ run_example_components
</pre></div>
</div>
<p>After this command the example components will start to send log messages to the log service so we should see something like:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ gds log_service client gmt
log client subscribed at port tcp://127.0.0.1:9995
subscription topic: gmt
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:24:38.730Z <span class="o">[</span>gmt://examples/my_app:7000<span class="o">]</span> starting
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:24:38.731Z <span class="o">[</span>gmt://examples/my_app:7000<span class="o">]</span> init
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:24:38.731Z <span class="o">[</span>gmt://examples/simple_component:8000<span class="o">]</span> starting
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:24:38.731Z <span class="o">[</span>gmt://examples/component_inc1:8001<span class="o">]</span> starting
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:24:38.731Z <span class="o">[</span>gmt://examples/component_inc2:8002<span class="o">]</span> starting
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:24:38.731Z <span class="o">[</span>gmt://examples/component_inc3:8003<span class="o">]</span> starting
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:24:38.731Z <span class="o">[</span>gmt://examples/component_sum1:8004<span class="o">]</span> starting
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:24:38.731Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> starting
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:24:38.732Z <span class="o">[</span>gmt://examples/component_inc2:8002<span class="o">]</span> <span class="nv">x1</span> <span class="o">=</span> <span class="m">1</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:24:38.732Z <span class="o">[</span>gmt://examples/simple_component:8000<span class="o">]</span> hello, component world
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:24:38.732Z <span class="o">[</span>gmt://examples/component_inc3:8003<span class="o">]</span> <span class="nv">x1</span> <span class="o">=</span> <span class="m">1</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:24:38.732Z <span class="o">[</span>gmt://examples/component_inc1:8001<span class="o">]</span> <span class="nv">x1</span> <span class="o">=</span> <span class="m">1</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:24:38.732Z <span class="o">[</span>gmt://examples/my_app:7000<span class="o">]</span> app step <span class="nv">num</span> <span class="o">=</span> <span class="m">0</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:24:38.732Z <span class="o">[</span>gmt://examples/component_sum1:8004<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">3</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:24:38.732Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">3</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:24:39.732Z <span class="o">[</span>gmt://examples/component_inc2:8002<span class="o">]</span> <span class="nv">x1</span> <span class="o">=</span> <span class="m">2</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:24:39.732Z <span class="o">[</span>gmt://examples/simple_component:8000<span class="o">]</span> hello, component world
</pre></div>
</div>
<p>At the startup the components are not setup and ports can&#8217;t be connected so each component is running alone.
For example, let&#8217;s see what the component sum2 is doing:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ gds log_service client sum2
log client subscribed at port tcp://127.0.0.1:9995
subscription topic: sum2
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:34:57.300Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> starting
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:34:57.301Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">3</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:34:58.301Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">3</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:34:59.301Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">3</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:35:00.301Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">3</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T16:35:01.301Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">3</span>
</pre></div>
</div>
<p>In this case the component sum2 is still not receiving values from other components so it&#8217;s only processing the default inputs.
As the ports x2 and x3 are always:</p>
<dl class="docutils">
<dt>::</dt>
<dd>sum2.x2 = 1   (see default constructor for Sum class components)
sum2.x3 = 2</dd>
</dl>
<p>then</p>
<dl class="docutils">
<dt>::</dt>
<dd>sum2.x1 = 3</dd>
</dl>
<p>In order to receive data from other components all components ports shall be setup.</p>
</div>
<div class="section" id="setup-components-and-ports">
<h2>8.4. Setup Components and Ports<a class="headerlink" href="#setup-components-and-ports" title="Permalink to this headline">¶</a></h2>
<p>When a components starts it will automatically run its step() loop at the required rate.
On each step() it checks its inputs, process the inputs and sets the outputs. At the init phase only the setup port is ready.
It can receive the following component setup:</p>
<blockquote>
<div><ul class="simple">
<li>tcpip_port num</li>
<li>Rate (can be dinamically changed)</li>
<li>Inputs: list of ports</li>
<li>Outputs: list of ports</li>
<li>Per each port: name, protocol (push/pull …), url, mode, step_rate</li>
</ul>
</div></blockquote>
<p>Any component can receive its setup using:</p>
<blockquote>
<div><em>Usage:</em>  <code class="docutils literal"><span class="pre">gds</span> <span class="pre">setup</span> <span class="pre">-m</span> <span class="pre">[model]</span> <span class="pre">-e</span> <span class="pre">[element]</span></code></div></blockquote>
<p>For example, <em>component_sum1</em> has the following configuration in:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Component</span> <span class="s2">&quot;component_inc1&quot;</span><span class="p">,</span>
    <span class="n">default</span><span class="p">:</span>
        <span class="n">properties</span><span class="p">:</span>
            <span class="n">uri_path</span><span class="p">:</span> <span class="s1">&#39;gmt://examples/component_inc1&#39;</span>
            <span class="n">host</span><span class="p">:</span> <span class="s1">&#39;127.0.0.1&#39;</span>
            <span class="n">port</span><span class="p">:</span> <span class="mi">8001</span>
            <span class="n">rate</span><span class="p">:</span> <span class="mi">1000000</span>
            <span class="n">acl</span><span class="p">:</span> <span class="s1">&#39;private&#39;</span>

        <span class="n">state_vars</span><span class="p">:</span> <span class="p">[]</span>

        <span class="n">input_ports</span><span class="p">:</span> <span class="p">[]</span>

        <span class="n">output_ports</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;x1&#39;</span><span class="p">,</span> <span class="n">protocol</span><span class="p">:</span> <span class="s1">&#39;push&#39;</span><span class="p">,</span>  <span class="n">url</span><span class="p">:</span> <span class="s1">&#39;tcp://127.0.0.1:9001&#39;</span><span class="p">,</span> <span class="n">blocking_mode</span><span class="p">:</span> <span class="s1">&#39;async&#39;</span><span class="p">,</span> <span class="n">max_rate</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
        <span class="p">]</span>
</pre></div>
</div>
<p>To connect all the example components as described in the previous section the following commands can be used:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ gds setup -m runtime -e component_inc1
$ gds setup -m runtime -e component_inc2
$ gds setup -m runtime -e component_inc3
$ gds setup -m runtime -e component_sum1
$ gds setup -m runtime -e component_sum2
</pre></div>
</div>
<p>and in terminal two we can see that the the component A2 is num processing the other component inputs.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ gds log_service client sum2
log client subscribed at port tcp://127.0.0.1:9995
subscription topic: sum2
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:21:57.385Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">3</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:21:58.385Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">3</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:21:59.385Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">3</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:22:00.386Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> new setup received
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:22:00.386Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> new port <span class="o">[</span>x1 -&gt; tcp://127.0.0.1:9005/push~async@1<span class="o">]</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:22:00.386Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> new port <span class="o">[</span>x2 -&gt; tcp://127.0.0.1:9004/pull~async@1<span class="o">]</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:22:00.386Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> new port <span class="o">[</span>x3 -&gt; tcp://127.0.0.1:9003/pull~async@1<span class="o">]</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:22:00.386Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">3</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:22:01.386Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">22</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:22:02.386Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">63</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:22:03.386Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">63</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:22:04.386Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">63</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:22:05.386Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">63</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:22:06.386Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">63</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:22:07.386Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">63</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:22:08.386Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">63</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:22:09.386Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">63</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:22:10.386Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">63</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:22:11.386Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">73</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:22:12.386Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">93</span>
<span class="o">[</span>INF<span class="o">]</span> <span class="m">2016</span>-09-06T17:22:13.386Z <span class="o">[</span>gmt://examples/component_sum2:8005<span class="o">]</span> <span class="nv">sum</span> <span class="o">=</span> <span class="m">93</span>
</pre></div>
</div>
<p>All components, except the application, run at the 1s rate. The application has a 3s step rate.
The application will run for 1000 steps and then will automatically finish.</p>
</div>
<div class="section" id="controllers-example">
<h2>8.5. Controllers Example<a class="headerlink" href="#controllers-example" title="Permalink to this headline">¶</a></h2>
<p>Controllers are the components responsible to control the different telescope or instruments devices.
Usually controllers are connected to the external sensors and actuators using the Hardware Adapters that we have seen before.
Many different kinds of controllers will be created for the telescope depending on the type of equipment to be controlled.
In order to know or maintain the state of the system under control the controllers will use State Variables.</p>
<p>A simple controller with a temperature state variable (simulated, with no real hardware) is provided.
Note that the controller implementation c++ code is split in three different files: general, setup and step.
This is for code generation purposes and because it&#8217;s easy to focus development only on the step() loop.</p>
<p>The configuration for this controller is:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Controller <span class="s2">&quot;simple_controller&quot;</span>,
    default:
        properties:
            uri_path: <span class="s1">&#39;gmt://examples/simple_controller&#39;</span>
            host: <span class="s1">&#39;127.0.0.1&#39;</span>
            port: <span class="m">8001</span>
            rate: <span class="m">1000000</span>
            acl: <span class="s1">&#39;private&#39;</span>

        state_vars: <span class="o">[</span>
            <span class="o">{</span> type: <span class="s1">&#39;float&#39;</span>, init: <span class="m">23</span>.4, min: <span class="m">2</span>.0, max: <span class="m">26</span>.1, url: <span class="s1">&#39;tcp://127.0.0.1:9011&#39;</span> <span class="o">}</span>
        <span class="o">]</span>

        input_ports: <span class="o">[</span>
            <span class="o">{</span> name: <span class="s1">&#39;temperature_setpoint&#39;</span>, protocol: <span class="s1">&#39;pull&#39;</span>,  url: <span class="s1">&#39;tcp://127.0.0.1:9001&#39;</span>, blocking_mode: <span class="s1">&#39;async&#39;</span>, max_rate: <span class="m">1</span> <span class="o">}</span>
        <span class="o">]</span>
        output_ports: <span class="o">[</span>
            <span class="o">{</span> name: <span class="s1">&#39;temperature_monitor&#39;</span>, protocol: <span class="s1">&#39;push&#39;</span>,  url: <span class="s1">&#39;tcp://127.0.0.1:9011&#39;</span>, blocking_mode: <span class="s1">&#39;async&#39;</span>, max_rate: <span class="m">1000</span> <span class="o">}</span>
        <span class="o">]</span>
</pre></div>
</div>
<p>In order to run this controller open a log_service client in a different terminal and in other terminal use:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ run_simple_controller <span class="p">&amp;</span>
</pre></div>
</div>
<p>then send the setup using:</p>
<blockquote>
<div>$ gds setup -m runtime -e simple_controller</div></blockquote>
</div>
<div class="section" id="check-monitored-values">
<h2>8.6. Check Monitored Values<a class="headerlink" href="#check-monitored-values" title="Permalink to this headline">¶</a></h2>
<p>Telemetry is a distributed service than can be started independently on each component as:</p>
<blockquote>
<div><em>Usage:</em>  <code class="docutils literal"><span class="pre">gds</span> <span class="pre">telemetry_service</span> <span class="pre">monitor</span> <span class="pre">-m</span> <span class="pre">model</span> <span class="pre">-e</span> <span class="pre">element</span></code></div></blockquote>
<p>This command will start the telemetry adapters for this component and they will send monitored values to the server.
The telemetry service will:</p>
<blockquote>
<div><ul class="simple">
<li>store data points in the database</li>
<li>send the values to subscribers</li>
<li>accept queries from clients</li>
</ul>
</div></blockquote>
<p>Note that monitors are the values of the output ports.</p>
<p>For example, the following command will start sending &#8216;temperature&#8217; data points to the telemetry service.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ gds telemetry_service monitor -m runtime -e simple_controller
</pre></div>
</div>
<p>To check the monitored values a telemetry client can be started in another unix terminal:</p>
<blockquote>
<div><em>Usage:</em>  <code class="docutils literal"><span class="pre">gds</span> <span class="pre">telemetry_service</span> <span class="pre">client</span> <span class="pre">monitor_name</span></code></div></blockquote>
<p>In the case will have:</p>
<blockquote>
<div>$ gds telemetry_service client temperature</div></blockquote>
<p>And the monitored values shall be received on this terminal.</p>
<p>A query can also be sent to the telemetry service like this:</p>
<blockquote>
<div><em>Usage:</em>  <code class="docutils literal"><span class="pre">gds</span> <span class="pre">telemetry_service</span> <span class="pre">query</span> <span class="pre">monitor_name</span> <span class="pre">num</span></code></div></blockquote>
<p>For example, the following will list the last 12 temperature values (from newest to oldest) from this controller:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ gds telemetry_service query gmt://examples/simple_controller/temperature_monitor <span class="m">10</span>
</pre></div>
</div>
<p>All telemetry queries have to be done on specific monitors.</p>
</div>
<div class="section" id="send-a-command-to-a-controller">
<h2>8.7. Send a Command to a Controller<a class="headerlink" href="#send-a-command-to-a-controller" title="Permalink to this headline">¶</a></h2>
<p>Some numeric values can be sent directly to ports of any controller like this:</p>
<blockquote>
<div><em>Usage:</em>  <code class="docutils literal"><span class="pre">gds</span> <span class="pre">push_value</span> <span class="pre">port_name</span> <span class="pre">value</span> <span class="pre">-m</span> <span class="pre">model</span> <span class="pre">-e</span> <span class="pre">element</span></code></div></blockquote>
<p>For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ gds push_value temperature_setpoint <span class="m">23</span>.2 -m runtime -e simple_controller
</pre></div>
</div>
<p>This will send a temperature setpoint of 23.2 to the controller which should react to this change.
Monitored values should change on the telemetry client.
When the temperature values are out the the defined range the log client should show the corresponding warning messages.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In order to finish the example the run_simple_controller process shall be killed.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="contribute.html" class="btn btn-neutral float-right" title="9. Contribute" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="services.html" class="btn btn-neutral" title="7. Using the Services" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, contributors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.4-1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
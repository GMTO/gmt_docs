

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8. Migration guide to SDK 1.6 &mdash; GMT Software And Controls documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/additional_style.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="GMT Software And Controls documentation" href="../index.html"/>
        <link rel="up" title="Software Development" href="index.html"/>
        <link rel="next" title="9. OCS Test Guidelines" href="test_guidelines.html"/>
        <link rel="prev" title="7.2. Mapping between the Model Definition Files and Coffeescript source code" href="model_language_mapping/mapping_model_to_coffee.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> GMT Software And Controls
          

          
            
            <img src="../_static/logowhite.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../release_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SWC_architecture/index.html">Architecture and Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SWC_standards/index.html">Software and Controls Standards</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Software Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">1. Installing the SDK</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrade.html">2. Upgrade</a></li>
<li class="toctree-l2"><a class="reference internal" href="virtual_machine/virtual_machine.html">3. Installing a Virtual Machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="gds_guide.html">4. gds documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="grs_guide.html">5. grs documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="modeling_guide/modeling_guidelines.html">6. Model specification guide document</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_language_mapping/index.html">7. Model-language mapping</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">8. Migration guide to SDK 1.6</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">8.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#update-the-model-files">8.2. Update the model files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#change-the-blocking-mode">8.2.1. Change the <code class="docutils literal"><span class="pre">blocking_mode</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-the-owner-attribute">8.2.2. Add the <code class="docutils literal"><span class="pre">owner</span></code> attribute</a></li>
<li class="toctree-l4"><a class="reference internal" href="#update-the-connectors">8.2.3. Update the connectors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#recompile-model-files">8.2.4. Recompile model files</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#update-the-source-files">8.3. Update the source files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reinstall-configurations">8.4. Reinstall configurations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="test_guidelines.html">9. OCS Test Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="core_services_user_guide.html">10. Core Services user guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="isample_example.html">11. ISample Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="hdk_example.html">12. HDK example</a></li>
<li class="toctree-l2"><a class="reference internal" href="ui_fwk.html">13. UI Framework</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../data_products/index.html">Data Products</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary/swc_sys_glossary.html">Software and Controls Acronyms and Definitions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GMT Software And Controls</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Software Development</a> &raquo;</li>
        
      <li>8. Migration guide to SDK 1.6</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="migration-guide-to-sdk-1-6">
<span id="sdk-1-6-migration-guide"></span><h1>8. Migration guide to SDK 1.6<a class="headerlink" href="#migration-guide-to-sdk-1-6" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>8.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In the release 1.6 of the SDK there have been several changes in the
C++ DCS mapping. Some of the most relevant changes are:</p>
<ul class="simple">
<li>There are two classes per Component instead of two: a base
class, with all the auto-generated code (i.e.: declaration of the State
Variables, Inputs, Outputs, the <code class="docutils literal"><span class="pre">setup</span></code> method, etc), a class that derives
from it that contains the user code, and finally the struct with the
configuration.</li>
<li>The file names are capitalized in CamelCase</li>
<li>The signature of the methods called inside the <code class="docutils literal"><span class="pre">setup</span></code> are slightly
changed</li>
<li>There are some new auto-generated methods</li>
<li>There is an Application class, that instantiates a Container class of
Components</li>
</ul>
<p>Most of the previous changes have been kept in the auto-generated code, so the
migration procedure is relatively simple.
As the changes to the code layout are significant, the best way to
proceed is to simply re-generate it, and then merge to the new code
the step function and the class attributes that were added by the user.</p>
<p>In this document, the steps to
migrate the pre-existing code will be explained. The instructions given here
will refer to a Component named <code class="docutils literal"><span class="pre">`MyComponent`</span></code> and a module named
<code class="docutils literal"><span class="pre">`ocs_my_dcs`</span></code> as an example.</p>
</div>
<div class="section" id="update-the-model-files">
<h2>8.2. Update the model files<a class="headerlink" href="#update-the-model-files" title="Permalink to this headline">¶</a></h2>
<p>First, we start by making some minor modifications to the model files,
as described in the next subsections.</p>
<div class="section" id="change-the-blocking-mode">
<h3>8.2.1. Change the <code class="docutils literal"><span class="pre">blocking_mode</span></code><a class="headerlink" href="#change-the-blocking-mode" title="Permalink to this headline">¶</a></h3>
<p>In the previous SDK the sync/async behavior of the input and output
ports were not fully implemented, and therefore there was no difference
in using one or the other one. However, in the semantics defined by
the modeling guide, a <code class="docutils literal"><span class="pre">sync</span></code> port is read or written automatically
by the core framework in each step, whilst an <code class="docutils literal"><span class="pre">async</span></code> port is only written
upon user request, and a handler is invoked when there some data is
incoming. The typical expected behavior in controller/hw_adapter pairs is
the <code class="docutils literal"><span class="pre">sync</span></code>, while for services or data oriented components the most
usual can be the <code class="docutils literal"><span class="pre">async</span></code>. However, due to historical reasons all the ports
in the examples were defined as <code class="docutils literal"><span class="pre">async</span></code>. Probably, the model files
of the module to be migrated will need to be changed to replace <code class="docutils literal"><span class="pre">async</span></code>
into <code class="docutils literal"><span class="pre">sync</span></code>.</p>
</div>
<div class="section" id="add-the-owner-attribute">
<h3>8.2.2. Add the <code class="docutils literal"><span class="pre">owner</span></code> attribute<a class="headerlink" href="#add-the-owner-attribute" title="Permalink to this headline">¶</a></h3>
<p>In the SDK version 1.6 the <code class="docutils literal"><span class="pre">owner</span></code> attribute was added to the Inputs
and Outputs. This attribute controls whether the current Component is
the owner of the actual connection. I.e., in case of Nanomsg, if it
is the one that listens to the socket. In all the communication groups,
one must be the owner and the rest must have this attribute to false.</p>
<p>Typically, the following pattern can be used:</p>
<ul class="simple">
<li>In a push/pull pair, the push side has the owner attribute set to false,
and the pull side has it to true.</li>
<li>In a pub/sub pair, the pub side has the owner as true, and the sub as
false.</li>
</ul>
<p>However, in each particular case the needs can be different, so it is
the responsibility of the developer to set correctly the owner attribute
of each port.</p>
<p>As an example, this is an excerpt from the HDK HwAdapter model:</p>
<div class="highlight-coffeescript"><div class="highlight"><pre><span></span><span class="nv">input_ports:</span>
  <span class="nv">operator_leds: </span>   <span class="p">{</span> <span class="nv">type: </span><span class="s">&#39;hdk_hmi_leds&#39;</span><span class="p">,</span>    <span class="nv">protocol: </span><span class="s">&#39;pull&#39;</span><span class="p">,</span> <span class="nv">blocking_mode: </span><span class="s">&#39;sync&#39;</span><span class="p">,</span> <span class="nv">owner: </span><span class="kc">true</span><span class="p">,</span> <span class="nv">max_rate: </span><span class="mi">1000</span><span class="p">,</span> <span class="nv">desc: </span><span class="s">&#39;Human Machine Interface (HMI) digital outputs&#39;</span> <span class="p">}</span>

<span class="nv">output_ports:</span>
  <span class="nv">operator_buttons: </span><span class="p">{</span> <span class="nv">type: </span><span class="s">&#39;hdk_hmi_buttons&#39;</span><span class="p">,</span> <span class="nv">protocol: </span><span class="s">&#39;push&#39;</span><span class="p">,</span> <span class="nv">blocking_mode: </span><span class="s">&#39;sync&#39;</span><span class="p">,</span> <span class="nv">owner: </span><span class="kc">false</span><span class="p">,</span> <span class="nv">max_rate: </span><span class="mi">1000</span><span class="p">,</span> <span class="nv">desc: </span><span class="s">&#39;Human Machine Interface (HMI) digital inputs&#39;</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="update-the-connectors">
<h3>8.2.3. Update the connectors<a class="headerlink" href="#update-the-connectors" title="Permalink to this headline">¶</a></h3>
<p>In the new SDK, the connectors that are defined in the model must have the
following format (extracted from <cite>ocs_isample_dcs/model/isample_ctrl_pkg/isample_ctrl_pkg.coffee</cite>):</p>
<div class="highlight-coffeescript"><div class="highlight"><pre><span></span><span class="nv">connectors:</span>
        <span class="c1"># Connectors from hardware adapter</span>
        <span class="nv">c9001: </span><span class="p">{</span> <span class="nv">id: </span><span class="mi">9001</span><span class="p">,</span> <span class="nv">from: </span><span class="p">{</span> <span class="nv">element: </span><span class="s">&quot;isample_hw1_adapter&quot;</span><span class="p">,</span>  <span class="nv">port: </span><span class="s">&quot;cryo_internal_temp&quot;</span><span class="p">},</span> <span class="nv">to: </span><span class="p">{</span> <span class="nv">element: </span><span class="s">&quot;isample_cryo_internal_temp_ctrl&quot;</span><span class="p">,</span> <span class="nv">port: </span><span class="s">&quot;temperatures&quot;</span><span class="p">},</span>        <span class="nv">max_latency: </span><span class="mf">0.5</span><span class="p">,</span> <span class="nv">nom_rate: </span><span class="mi">100</span><span class="p">,</span> <span class="nv">on_fault: </span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nv">conversion: </span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nv">bus: </span><span class="s">&quot;&quot;</span> <span class="p">}</span>
        <span class="nv">c9002: </span><span class="p">{</span> <span class="nv">id: </span><span class="mi">9002</span><span class="p">,</span> <span class="nv">from: </span><span class="p">{</span> <span class="nv">element: </span><span class="s">&quot;isample_hw1_adapter&quot;</span><span class="p">,</span>  <span class="nv">port: </span><span class="s">&quot;cryo_external_temp&quot;</span><span class="p">},</span> <span class="nv">to: </span><span class="p">{</span> <span class="nv">element: </span><span class="s">&quot;isample_cryo_external_temp_ctrl&quot;</span><span class="p">,</span> <span class="nv">port: </span><span class="s">&quot;temperatures&quot;</span><span class="p">},</span>        <span class="nv">max_latency: </span><span class="mf">0.5</span><span class="p">,</span> <span class="nv">nom_rate: </span><span class="mi">100</span><span class="p">,</span> <span class="nv">on_fault: </span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nv">conversion: </span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nv">bus: </span><span class="s">&quot;&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>As can be seen in the previous example, the previous vector of connectors must
be transformed to a dictionary, where the key is a unique identifier for
the connector.</p>
</div>
<div class="section" id="recompile-model-files">
<h3>8.2.4. Recompile model files<a class="headerlink" href="#recompile-model-files" title="Permalink to this headline">¶</a></h3>
<p>Finally, we must apply the previous changes by recompiling the model files:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="nv">$GMT_LOCAL</span>/modules/ocs_my_dcs/model
$ webpack
</pre></div>
</div>
</div>
</div>
<div class="section" id="update-the-source-files">
<h2>8.3. Update the source files<a class="headerlink" href="#update-the-source-files" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first"><strong>Rename the “src/cpp“ directory</strong>:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="nv">$GMT_LOCAL</span>/modules/ocs_my_dcs/src
$ mv cpp cpp.refactor
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><strong>Generate back the C++ code from the model</strong>:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>$ gds gen ocs_my_dcs
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">src/cpp</span></code> directory will be created back, and it will contain the skeletons
for the components defined in the model files. We will have two classes per
each Component: one declared in the file <cite>MyComponentBase.h`</cite>, with the component features
defined in the model (State Variables, Inputs, Outputs, …), and another one declared
in the file <code class="docutils literal"><span class="pre">MyComponent.h</span></code>, which is where the developer must add the application
specific code.</p>
</div></blockquote>
</li>
<li><dl class="first docutils">
<dt><strong>Add the step function</strong>. The derived class, contained in the file</dt>
<dd><p class="first last"><code class="docutils literal"><span class="pre">MyComponent.h</span></code> is the one that now implements the <code class="docutils literal"><span class="pre">step</span></code> function.
The contents of the old step function, that are in the <code class="docutils literal"><span class="pre">my_component_step.cpp</span></code>
file under the appropriate subdirectory of <code class="docutils literal"><span class="pre">src/cpp.refactor</span></code> backup must
be copied to the <code class="docutils literal"><span class="pre">MyComponent::step()</span></code> function in <code class="docutils literal"><span class="pre">MyComponent.cpp</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>Add the user declarations to the derived class</strong>. Any member variable or</dt>
<dd><p class="first last">method that were added by the developer in the component class, must be
copied to the derived class, under <code class="docutils literal"><span class="pre">MyComponent.h</span></code> and <code class="docutils literal"><span class="pre">MyComponent.cpp</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>Async handlers</strong>. If there are any <code class="docutils literal"><span class="pre">async</span></code> Data I/Os, then add the handlers</dt>
<dd><p class="first last">in the <code class="docutils literal"><span class="pre">MyComponent::setup()</span></code> method.</p>
</dd>
</dl>
</li>
<li><p class="first"><strong>Recompile the code</strong>:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> src/cpp
$ make clean
$ make
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="reinstall-configurations">
<h2>8.4. Reinstall configurations<a class="headerlink" href="#reinstall-configurations" title="Permalink to this headline">¶</a></h2>
<p>The configuration files must be reinstalled, as described in <a class="reference internal" href="isample_example.html#compil-config"><span class="std std-ref">Installing the configuration</span></a>.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="test_guidelines.html" class="btn btn-neutral float-right" title="9. OCS Test Guidelines" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="model_language_mapping/mapping_model_to_coffee.html" class="btn btn-neutral" title="7.2. Mapping between the Model Definition Files and Coffeescript source code" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, contributors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.8.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>11. ISample Example &mdash; GMT Software And Controls documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/additional_style.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="GMT Software And Controls documentation" href="../index.html"/>
        <link rel="up" title="Software Development" href="index.html"/>
        <link rel="next" title="12. HDK example" href="hdk_example.html"/>
        <link rel="prev" title="10. Core Services user guide" href="core_services_user_guide.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> GMT Software And Controls
          

          
            
            <img src="../_static/logowhite.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.13
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../release_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SWC_architecture/index.html">Architecture and Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SWC_standards/index.html">Software and Controls Standards</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Software Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">1. Installing the SDK</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrade.html">2. Upgrade</a></li>
<li class="toctree-l2"><a class="reference internal" href="virtual_machine/virtual_machine.html">3. Installing a Virtual Machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="gds_guide.html">4. gds documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="grs_guide.html">5. grs documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="modeling_guide/modeling_guidelines.html">6. Model specification guide document</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_language_mapping/index.html">7. Model-language mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="sdk_1_6_migration_guide.html">8. Migration guide to SDK 1.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_guidelines.html">9. OCS Test Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="core_services_user_guide.html">10. Core Services user guide</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">11. ISample Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configure-git-to-access-gmto-s-repositories">11.1. Configure git to access GMTO’s repositories</a></li>
<li class="toctree-l3"><a class="reference internal" href="#clone-the-isample-dcs-repository">11.2. Clone the isample_dcs repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-files">11.3. Model Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code-generation">11.4. Code Generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#component-attributes">11.5. Component Attributes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#state-variables">11.5.1. State Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inputs">11.5.2. Inputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#outputs">11.5.3. Outputs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#optional-defining-component-behavior">11.6. (Optional) Defining component behavior</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compilation">11.7. Compilation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-the-configuration">11.8. Installing the configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-example">11.9. Running the Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#log-service">11.9.1. Log Service</a></li>
<li class="toctree-l4"><a class="reference internal" href="#telemetry-service">11.9.2. Telemetry Service</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interacting-with-a-component">11.9.3. Interacting with a component</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="hdk_example.html">12. HDK example</a></li>
<li class="toctree-l2"><a class="reference internal" href="ui_fwk.html">13. UI Framework</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../data_products/index.html">Data Products</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary/swc_sys_glossary.html">Software and Controls Acronyms and Definitions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GMT Software And Controls</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Software Development</a> &raquo;</li>
        
      <li>11. ISample Example</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="isample-example">
<span id="id1"></span><h1>11. ISample Example<a class="headerlink" href="#isample-example" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="development/specification/specification.html#dcs-spec-example"><span class="std std-ref">ISample DCS</span></a> is an instrument control system example that provides
a template that instrument developers can use as a model.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The following instructions assume that the SDK has been installed and the Development Environment configured correctly according to the instructions in <a class="reference internal" href="installation.html#installation"><span class="std std-ref">Installing the SDK</span></a> or <a class="reference internal" href="upgrade.html#upgrade"><span class="std std-ref">Upgrade</span></a>.</p>
</div>
<div class="section" id="configure-git-to-access-gmto-s-repositories">
<h2>11.1. Configure git to access GMTO’s repositories<a class="headerlink" href="#configure-git-to-access-gmto-s-repositories" title="Permalink to this headline">¶</a></h2>
<p>In order to access private repositories on Github, an account with access permissions should be set up.</p>
<ol class="arabic">
<li><p class="first">Log in in github and check if your user has access to the ISample repository: <a class="reference external" href="https://github.com/GMTO/ocs_isample_dcs">https://github.com/GMTO/ocs_isample_dcs</a>
If a 404 error is shown when entering the ISample webpage, please contact us to solve the permission issues.</p>
<p><a class="reference external" href="https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh">https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh</a></p>
</li>
<li><p class="first">Configure your GitHub account to access using a ssh a token:
<a class="reference external" href="https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token">https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token</a></p>
</li>
</ol>
</div>
<div class="section" id="clone-the-isample-dcs-repository">
<h2>11.2. Clone the isample_dcs repository<a class="headerlink" href="#clone-the-isample-dcs-repository" title="Permalink to this headline">¶</a></h2>
<p>On the development machine, clone the repository in the development folder:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="nv">$GMT_LOCAL</span>/modules
$ git clone git@github.com:GMTO/ocs_isample_dcs.git
</pre></div>
</div>
<p>where the <code class="docutils literal"><span class="pre">-d</span> <span class="pre">option</span></code> defines the git repository owner. The output from the command
will be:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git clone git@github.com:GMTO/ocs_isample_dcs.git
  Cloning into <span class="s1">&#39;ocs_isample_dcs&#39;</span>...
  remote: Enumerating objects: <span class="m">1049</span>, <span class="k">done</span>.
  remote: Counting objects: <span class="m">100</span>% <span class="o">(</span><span class="m">100</span>/100<span class="o">)</span>, <span class="k">done</span>.
  remote: Compressing objects: <span class="m">100</span>% <span class="o">(</span><span class="m">60</span>/60<span class="o">)</span>, <span class="k">done</span>.
  remote: Total <span class="m">1049</span> <span class="o">(</span>delta <span class="m">53</span><span class="o">)</span>, reused <span class="m">78</span> <span class="o">(</span>delta <span class="m">37</span><span class="o">)</span>, pack-reused <span class="m">949</span>
  Receiving objects: <span class="m">100</span>% <span class="o">(</span><span class="m">1049</span>/1049<span class="o">)</span>, <span class="m">166</span>.06 KiB <span class="p">|</span> <span class="m">1</span>.14 MiB/s, <span class="k">done</span>.
  Resolving deltas: <span class="m">100</span>% <span class="o">(</span><span class="m">620</span>/620<span class="o">)</span>, <span class="k">done</span>.
</pre></div>
</div>
</div>
<div class="section" id="model-files">
<h2>11.3. Model Files<a class="headerlink" href="#model-files" title="Permalink to this headline">¶</a></h2>
<p>The model files can be found in the <strong>$GMT_LOCAL/modules/ocs_isample_dcs/model/</strong> folder.</p>
<dl class="docutils">
<dt>isample_dcs.coffee</dt>
<dd>Lists the connectors between the supervisor layer and the component layer, also lists the types to be generated during code generation.</dd>
<dt>isample_dcs_def.coffee</dt>
<dd>High-level definition file, representing the WBS for the submodule. It lists the components and how the code will be generated.</dd>
<dt>isample_dcs_types.coffee</dt>
<dd>Definitions of structs and data types used by the isample components.</dd>
<dt>isample_ctrl_pkg/isample_ctrl_fb.coffee</dt>
<dd>Fieldbus definitions for the isample control package.</dd>
<dt>isample_ctrl_pkg/isample_ctrl_pkg.coffee</dt>
<dd>Describes the control package and lists the connectors between components of the package.</dd>
<dt>isample_ctrl_pkg/isample_ctrl_super.coffee</dt>
<dd>Definition of the <em>Control Supervisor</em> component. State variables, input and output ports are specified here. A single instance called <strong>isample_ctrl_super</strong> will be created.</dd>
<dt>isample_ctrl_pkg/isample_filter_wheel_ctrl.coffee</dt>
<dd>Definition of the <em>Filter Wheel Controller</em> component. State variables, input and output ports are specified here. Two instances, called <strong>isample_fw1_ctrl</strong> and <strong>isample_fw2_ctrl</strong> will be created.</dd>
<dt>isample_ctrl_pkg/isample_focus_ctrl.coffee</dt>
<dd>Definition of the <em>Focus Controller</em> component. State variables, input and output ports are specified here. A single instance called <strong>isample_focus1_ctrl</strong> will be created.</dd>
<dt>isample_ctrl_pkg/isample_hw_adapter.coffee</dt>
<dd>Definition of the <em>Hardware Adapter</em> component used to interface with the isample Actuators and Sensors. State variables, input and output ports are specified here. A single instance called <strong>isample_hw1_adapter</strong> will be created.</dd>
<dt>isample_ctrl_pkg/isample_temp_ctrl.coffee</dt>
<dd>Definition of the <em>Temperature Controller</em> component. State variables, input and output ports are specified here. Two instances, called <strong>isample_cryo_internal_temp_ctrl</strong> and <strong>isample_cryo_external_temp_ctrl</strong> will be created.</dd>
</dl>
<div class="highlight-bash"><div class="highlight"><pre><span></span>  Control                   Internal                     Hardware
 Supervisor               Temp Control                    Adapter
+--------------+         +-------------+             +---------------+
<span class="p">|</span>              <span class="p">|</span>&lt;--------<span class="p">|</span>             <span class="p">|</span>             <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         <span class="p">|</span>             <span class="p">|</span>             <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         <span class="p">|</span>  temperature<span class="p">|</span>&lt;------------<span class="p">|</span>int temp       <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         +-------------+             <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>                                     <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>             External                <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>           Temp Control              <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         +-------------+             <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>&lt;--------<span class="p">|</span>             <span class="p">|</span>             <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         <span class="p">|</span>             <span class="p">|</span>             <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         <span class="p">|</span>  temperature<span class="p">|</span>&lt;------------<span class="p">|</span>ext temp       <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         +-------------+             <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>                                     <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>                                     <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>                                     <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>           Filter Wheel              <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>            Control <span class="m">1</span>                <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         +--------------+            <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>&lt;--------<span class="p">|</span>              <span class="p">|</span>            <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         <span class="p">|</span>              <span class="p">|</span>            <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         <span class="p">|</span> motor control<span class="p">|</span>-----------&gt;<span class="p">|</span>fw1 control    <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         <span class="p">|</span>   motor state<span class="p">|</span>&lt;-----------<span class="p">|</span>fw1 state      <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         +--------------+            <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>                                     <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>           Filter Wheel              <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>            Control <span class="m">2</span>                <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         +--------------+            <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>&lt;--------<span class="p">|</span>              <span class="p">|</span>            <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         <span class="p">|</span>              <span class="p">|</span>            <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         <span class="p">|</span> motor control<span class="p">|</span>-----------&gt;<span class="p">|</span>fw2 control    <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         <span class="p">|</span>   motor state<span class="p">|</span>&lt;-----------<span class="p">|</span>fw2 state      <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         +--------------+            <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>                                     <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>                                     <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>                                     <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>           Focus Control             <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         +--------------+            <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>&lt;--------<span class="p">|</span>              <span class="p">|</span>            <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         <span class="p">|</span>              <span class="p">|</span>            <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         <span class="p">|</span>    hmi output<span class="p">|</span>-----------&gt;<span class="p">|</span>LEDs           <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         <span class="p">|</span> motor control<span class="p">|</span>-----------&gt;<span class="p">|</span>focus control  <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         <span class="p">|</span>     hmi input<span class="p">|</span>&lt;-----------<span class="p">|</span>buttons        <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         <span class="p">|</span>   motor state<span class="p">|</span>&lt;-----------<span class="p">|</span>focus state    <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>         +--------------+            <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>                                     <span class="p">|</span>               <span class="p">|</span>
<span class="p">|</span>              <span class="p">|</span>                                     <span class="p">|</span>               <span class="p">|</span>
+--------------+                                     +---------------+
</pre></div>
</div>
</div>
<div class="section" id="code-generation">
<h2>11.4. Code Generation<a class="headerlink" href="#code-generation" title="Permalink to this headline">¶</a></h2>
<p>To generate the code skeleton from the model files, execute:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="nv">$GMT_LOCAL</span>/modules/ocs_isample_dcs/model
$ webpack
$ gds gen isample_dcs
</pre></div>
</div>
<p>This will generate the basic framework of source code and configuration files for each component.
The generated source files will be located in the <cite>src/</cite> folder. Gds may output some warnings because there are missing modules which are defined in the
local bundle (in particular, the hdk). This is
not a problem, and the code will be successfully generated.</p>
<p>To see the generated folders and files, navigate to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="nv">$GMT_LOCAL</span>/modules/ocs_isample_dcs/src/
$ ls -la
</pre></div>
</div>
</div>
<div class="section" id="component-attributes">
<h2>11.5. Component Attributes<a class="headerlink" href="#component-attributes" title="Permalink to this headline">¶</a></h2>
<p>Components are defined by their state variables, input ports, output ports and step function.</p>
<p>The Filter Wheel component has the following attributes:</p>
<div class="section" id="state-variables">
<h3>11.5.1. State Variables<a class="headerlink" href="#state-variables" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="20%" />
<col width="45%" />
<col width="14%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Name</th>
<th class="head">Range</th>
<th class="head">Default</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>float</td>
<td>position</td>
<td>min: 5, max: 40</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>OperationalState</td>
<td>op_state</td>
<td>OFF, STARTING, ON, INITIALIZING,
RUN, HALTING, SHUTTING_DOWN,
FAULT, RESETTING, DISABLED</td>
<td>OFF</td>
</tr>
<tr class="row-even"><td>SimulationMode</td>
<td>sim_mode</td>
<td>SIMULATION, ON_LINE</td>
<td>ON_LINE</td>
</tr>
<tr class="row-odd"><td>ControlMode</td>
<td>control_mode</td>
<td>STANDALONE, INTEGRATED</td>
<td>STANDALONE</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><em>OperationalState, SimulationMode and ControlMode are enums with their respective values shown in the “Range” column above.</em></p>
</div>
<div class="section" id="inputs">
<h3>11.5.2. Inputs<a class="headerlink" href="#inputs" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="30%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Name</th>
<th class="head">Internal variable</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>isample_motor_status</td>
<td>motor_state</td>
<td>motor_state</td>
</tr>
<tr class="row-odd"><td>float</td>
<td>position_goal</td>
<td>position.goal</td>
</tr>
<tr class="row-even"><td>OperationalState</td>
<td>ops_state_goal</td>
<td>ops_state.goal</td>
</tr>
<tr class="row-odd"><td>SimulationMode</td>
<td>sim_mode_goal</td>
<td>sim_mode.goal</td>
</tr>
<tr class="row-even"><td>ControlMode</td>
<td>control_mode_goal</td>
<td>control_mode.goal</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>where the struct <cite>isample_motor_status</cite> is defined as:</p>
<blockquote>
<div><div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">isample_motor_status</span> <span class="p">{</span>
    <span class="kt">bool</span>             <span class="n">ready</span><span class="p">;</span>                   <span class="c1">// Axis Ready</span>
    <span class="kt">bool</span>             <span class="n">enabled</span><span class="p">;</span>                 <span class="c1">// Axis Enabled</span>
    <span class="kt">bool</span>             <span class="n">warning</span><span class="p">;</span>                 <span class="c1">// Axis Warning</span>
    <span class="kt">bool</span>             <span class="n">error</span><span class="p">;</span>                   <span class="c1">// Axis Error</span>
    <span class="kt">bool</span>             <span class="n">moving_positive</span><span class="p">;</span>         <span class="c1">// Axis Moving +</span>
    <span class="kt">bool</span>             <span class="n">moving_negative</span><span class="p">;</span>         <span class="c1">// Axis Moving -</span>
    <span class="n">MSGPACK_DEFINE_MAP</span><span class="p">(</span><span class="n">ready</span><span class="p">,</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">warning</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">moving_positive</span><span class="p">,</span> <span class="n">moving_negative</span><span class="p">)</span>
<span class="p">};</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="outputs">
<h3>11.5.3. Outputs<a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="30%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Name</th>
<th class="head">Internal Variable</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>isample_motor_control</td>
<td>motor_control</td>
<td>motor_control</td>
</tr>
<tr class="row-odd"><td>float</td>
<td>position_value</td>
<td>position.value</td>
</tr>
<tr class="row-even"><td>OperationalState</td>
<td>ops_state_value</td>
<td>ops_state.value</td>
</tr>
<tr class="row-odd"><td>SimulationMode</td>
<td>sim_mode_value</td>
<td>sim_mode.value</td>
</tr>
<tr class="row-even"><td>ControlMode</td>
<td>control_mode_value</td>
<td>control_mode.value</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>where the struct <cite>isample_motor_control</cite> is defined as:</p>
<blockquote>
<div><div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">isample_motor_control</span> <span class="p">{</span>
    <span class="kt">bool</span>             <span class="n">enable</span><span class="p">;</span>                  <span class="c1">// Axis Enable</span>
    <span class="kt">bool</span>             <span class="n">reset</span><span class="p">;</span>                   <span class="c1">// Axis Reset</span>
    <span class="kt">int16_t</span>          <span class="n">velocity</span><span class="p">;</span>                <span class="c1">// Velocity</span>
    <span class="n">MSGPACK_DEFINE_MAP</span><span class="p">(</span><span class="n">enable</span><span class="p">,</span> <span class="n">reset</span><span class="p">,</span> <span class="n">velocity</span><span class="p">)</span>
<span class="p">};</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="optional-defining-component-behavior">
<h2>11.6. (Optional) Defining component behavior<a class="headerlink" href="#optional-defining-component-behavior" title="Permalink to this headline">¶</a></h2>
<p>The core component behavior is specified in the component cpp file. The component
has a periodic thread that reads input from the input ports, runs the step
function and then writes output to the output ports. Initially, the generated
step function will check whether the component is correctly configured and, if
so, will log the current step counter value.</p>
<p>In the following examples, we will replace the basic step functionality with
simulated controller behavior.</p>
<p>To edit the <em>Filter Wheel Controller</em> step function:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="nv">$GMT_LOCAL</span>/modules/ocs_isample_dcs/src/cpp/
$ <span class="nb">cd</span> isample_ctrl_pkg/isample_filter_wheel_ctrl
$ vi IsampleFilterWheelCtrl.cpp
</pre></div>
</div>
<p>The following example step function for the filter wheel controller validates
positional input and immediately sets the position value to the new goal, if possible.</p>
<blockquote>
<div><div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">IsampleFilterWheelCtrl</span><span class="o">::</span><span class="n">step</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_step_rate</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">goal</span> <span class="o">!=</span> <span class="n">position</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// check range</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">goal</span> <span class="o">&gt;=</span> <span class="n">position</span><span class="p">.</span><span class="n">max</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">log_warning</span><span class="p">(</span><span class="s">&quot;Position is at or exceeding maximum value: &quot;</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">max</span><span class="p">));</span>
                <span class="c1">// prevent further movement</span>
                <span class="n">position</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">position</span><span class="p">.</span><span class="n">max</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">goal</span> <span class="o">&lt;=</span> <span class="n">position</span><span class="p">.</span><span class="n">min</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">log_warning</span><span class="p">(</span><span class="s">&quot;Position is at or exceeding minimum value: &quot;</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">min</span><span class="p">));</span>
                <span class="c1">// prevent further movement</span>
                <span class="n">position</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">position</span><span class="p">.</span><span class="n">min</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="c1">// achieve target position immediately</span>
                <span class="n">position</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">position</span><span class="p">.</span><span class="n">goal</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="c1">// report value</span>
            <span class="n">log_info</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">value</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="compilation">
<h2>11.7. Compilation<a class="headerlink" href="#compilation" title="Permalink to this headline">¶</a></h2>
<p>To compile the C++ Control Package code, edit the module.mk file to contain the correct library definitions:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ vi <span class="nv">$GMT_LOCAL</span>/modules/ocs_isample_dcs/src/cpp/isample_ctrl_pkg/module.mk
</pre></div>
</div>
<p>Ensure that the following lines are defined:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># Add in this file the compile flags for the package, eg:</span>
<span class="nv">MOD_BUILD_LDFLAGS</span> <span class="o">+=</span> -lcore_core_pkg -lio_core_pkg -lctrl_core_pkg
</pre></div>
</div>
<p>Run <strong>make</strong> to compile the code:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="nv">$GMT_LOCAL</span>/modules/ocs_isample_dcs/src/cpp
$ make
</pre></div>
</div>
</div>
<div class="section" id="installing-the-configuration">
<h2>11.8. Installing the configuration<a class="headerlink" href="#installing-the-configuration" title="Permalink to this headline">¶</a></h2>
<p id="compil-config">The configuration files are autogenerated in the <cite>$GMT_LOCAL/modules/ocs_isample_dcs/src/etc/conf</cite> directory,
but they need to be installed to <cite>$GMT_LOCAL/etc/conf</cite> to be used by
the application.</p>
<p>To install the configuration files, execute the following commands:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ gds install isample_dcs
$ grs compile isample_dcs
</pre></div>
</div>
</div>
<div class="section" id="running-the-example">
<h2>11.9. Running the Example<a class="headerlink" href="#running-the-example" title="Permalink to this headline">¶</a></h2>
<p>Start the logging and telemetry services:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ log_server <span class="p">&amp;</span>
$ tele_server <span class="p">&amp;</span>
</pre></div>
</div>
<p>Start the ISample Control Package application in the background.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ isample_ctrl_app <span class="p">&amp;</span>
</pre></div>
</div>
<p>The application is running in the background and will not provide any console output.
All output will be directed to the logging service after the components have been successfully set up.</p>
<div class="section" id="log-service">
<h3>11.9.1. Log Service<a class="headerlink" href="#log-service" title="Permalink to this headline">¶</a></h3>
<p>In a separate terminal (for example, <cite>tty2</cite>), <strong>start the logging service client</strong>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ log_client listen
</pre></div>
</div>
</div>
<div class="section" id="telemetry-service">
<h3>11.9.2. Telemetry Service<a class="headerlink" href="#telemetry-service" title="Permalink to this headline">¶</a></h3>
<p>In a separate terminal, <strong>start the telemetry service client</strong>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ tele_client listen
</pre></div>
</div>
<p>In this example, we don’t filter to show data for all monitors.
The output can be filtered on substrings of the monitor name by specifying the
topic to be a specific component type (<code class="docutils literal"><span class="pre">filter_wheel_ctrl</span></code>) or an output port
name, such as <code class="docutils literal"><span class="pre">position</span></code>. For example,</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ tele_client listen --topic<span class="o">=</span>isample_focus1_ctrl/hmi_outputs
</pre></div>
</div>
<p>will show only the values of the <code class="docutils literal"><span class="pre">hmi_outputs</span></code> monitor from <code class="docutils literal"><span class="pre">isample_focus1_ctrl</span></code>.</p>
</div>
<div class="section" id="interacting-with-a-component">
<h3>11.9.3. Interacting with a component<a class="headerlink" href="#interacting-with-a-component" title="Permalink to this headline">¶</a></h3>
<p>The <cite>grs</cite> command-line application can be used to interact with Components.
Some of the functionalities provided by this application are querying the
current value of a given Component feature (property, state variable, input
or output), setting a value or inspecting the whole Component state.</p>
<p>The <cite>grs get</cite> subcommand allows us to query the current value of a feature. The
syntax is</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ grs get &lt;instance&gt; -f &lt;feature&gt;
</pre></div>
</div>
<p>For example, to read the value of the <cite>position</cite> state variable of the
<cite>isample_fw1_ctrl</cite> instance, execute:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ grs get isample_fw1_ctrl -f state_vars/position/value
</pre></div>
</div>
<p>To set a value, the <cite>grs set</cite> subcommand can be used:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ grs <span class="nb">set</span> &lt;instance&gt; -f &lt;feature&gt; -v &lt;value&gt;
</pre></div>
</div>
<p>For example, to set the goal of the <cite>position</cite> state variable of the
<cite>isample_fw1_ctrl</cite> instance, execute:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ grs <span class="nb">set</span> isample_fw1_ctrl -f state_vars/position/goal -v <span class="m">2</span>.0
</pre></div>
</div>
<p>Finally, to inspect the whole state, use the <cite>grs inspect</cite> command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ grs inspect &lt;instance&gt;
</pre></div>
</div>
<p>As before, to inspect the state of the <cite>isample_fw1_ctrl</cite> instance, execute:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ grs inspect isample_fw1_ctrl
</pre></div>
</div>
<p><a class="reference internal" href="#isample-example"><span class="std std-ref">[back to top]</span></a></p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="hdk_example.html" class="btn btn-neutral float-right" title="12. HDK example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="core_services_user_guide.html" class="btn btn-neutral" title="10. Core Services user guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, contributors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.13.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>